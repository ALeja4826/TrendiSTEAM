#include <Wire.h>
#include <LiquidCrystal_I2C.h>

#define TRIG_PIN 9  // Pin del sensor ultrasónico (Trigger)
#define ECHO_PIN 10 // Pin del sensor ultrasónico (Echo)
#define ALTURA_CANECA 31 // Altura total de la caneca en cm

LiquidCrystal_I2C lcd(0x27, 16, 2); // Dirección I2C de la pantalla LCD

void setup() {
    pinMode(TRIG_PIN, OUTPUT);
    pinMode(ECHO_PIN, INPUT);
    lcd.init();
    lcd.backlight();
    
    // Mensaje de carga inicial
    lcd.setCursor(0, 0);
    lcd.print("Cargando...");
    delay(2000);
    lcd.clear();
}

void loop() {
    int distancia = medirDistancia();

    lcd.clear(); // Borra la pantalla antes de actualizar
    
    if (distancia <= 1) {
        lcd.setCursor(0, 0);
        lcd.print("Caneca llena");
    } 
    else if (distancia > 1 && distancia < ALTURA_CANECA) {
        lcd.setCursor(0, 0);
        lcd.print("Distancia: ");
        lcd.setCursor(0, 1);
        lcd.print(distancia);
        lcd.print(" cm");
    } 
    else {
        lcd.setCursor(0, 0);
        lcd.print("Caneca vacia");
        lcd.setCursor(0, 1);
        lcd.print("31 cm");
    }

    delay(1000); // Refresco de la pantalla cada segundo
}

// Función para medir la distancia con el sensor ultrasónico
int medirDistancia() {
    digitalWrite(TRIG_PIN, LOW);
    delayMicroseconds(2);
    digitalWrite(TRIG_PIN, HIGH);
    delayMicroseconds(10);
    digitalWrite(TRIG_PIN, LOW);
    
    long duracion = pulseIn(ECHO_PIN, HIGH);
    int distancia = duracion * 0.034 / 2; // Conversión a cm

    return distancia;
}
